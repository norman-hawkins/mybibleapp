generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")

}

enum Role {
  ADMIN
  CONTRIBUTOR
  USER
}

enum CommentaryStatus {
  DRAFT
  PENDING_REVIEW
  PUBLISHED
  REJECTED
}

model User {
  id            String    @id @default(cuid())
  name          String?
  email         String    @unique
  passwordHash  String?
  emailVerified DateTime?
  image         String?

  role         Role         @default(USER)
  commentaries Commentary[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BibleReference {
  id String @id @default(uuid())

  book       String
  chapter    Int
  verseStart Int
  verseEnd   Int?

  commentaries Commentary[]

  @@index([book, chapter])
}

model Commentary {
  id      String @id @default(cuid())
  content String

  book    String
  chapter Int
  verse   Int?

  authorId String
  author   User   @relation(fields: [authorId], references: [id])

  status CommentaryStatus @default(DRAFT)

  // âœ… Review metadata (admin workflow)
  reviewedAt     DateTime?
  reviewedById   String?
  rejectionReason String?

  createdAt        DateTime        @default(now())
  updatedAt        DateTime        @updatedAt
  bibleReference   BibleReference? @relation(fields: [bibleReferenceId], references: [id])
  bibleReferenceId String?
}

model SourceSegment {
  id           String   @id @default(cuid())
  sourceKey    String   // "ken_raggio"
  book         String   // "1chronicles"
  chapterStart Int
  chapterEnd   Int
  verseStart   Int?
  verseEnd     Int?
  anchorsJson  String?  // JSON string: [{chapter,verse},...]
  heading      String
  content      String   @db.Text
  anchorRaw    String
  orderIndex   Int
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt

  @@index([sourceKey, book, chapterStart, chapterEnd])
  @@index([sourceKey, book, chapterStart, verseStart, verseEnd])
}
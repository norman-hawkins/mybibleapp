import fs from "fs";
import path from "path";

const ROOT = process.cwd();
const WEB_DIR = path.join(ROOT, "data/bible/WEB");
const OUT_FILE = path.join(WEB_DIR, "index.ts");

function isDir(p) {
  return fs.existsSync(p) && fs.statSync(p).isDirectory();
}

function listDirs(dir) {
  return fs.readdirSync(dir).filter((name) => isDir(path.join(dir, name)));
}

function listJsonFiles(dir) {
  return fs.readdirSync(dir).filter((name) => name.endsWith(".json")).sort();
}

const books = listDirs(WEB_DIR);

let out = `/* AUTO-GENERATED by scripts/generate-bible-index.mjs */\n`;
out += `export const WEB = {\n`;

for (const book of books) {
  const bookDir = path.join(WEB_DIR, book);
  const files = listJsonFiles(bookDir);

  out += `  "${book}": {\n`;
  for (const f of files) {
    const chapterKey = f.replace(".json", "");
    out += `    "${chapterKey}": require("./${book}/${f}"),\n`;
  }
  out += `  },\n`;
}

out += `} as const;\n`;

fs.writeFileSync(OUT_FILE, out, "utf8");
console.log(`âœ… Wrote ${OUT_FILE}`);

